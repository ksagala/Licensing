function modalOkClick(e){document.getElementById("modal").style.display="none",modalOkCallback&&modalOkCallback(e)}function modalCancelClick(e){document.getElementById("modal").style.display="none",modalCancelCallback&&modalCancelCallback(e)}function modalInputKeyUpEvent(e){if("Enter"===e.key){const t=document.getElementById("modal-ok");if(!t)return;e.preventDefault(),t.click()}}function setupModal(){const e=document.createElement("div");e.id="modal",document.body.appendChild(e);const t=document.createElement("div");t.id="modal-content",e.appendChild(t);const n=document.createElement("p");n.id="modal-text",t.appendChild(n);const i=document.createElement("input");i.id="modal-input",i.type="text",t.appendChild(i),i.addEventListener("keyup",modalInputKeyUpEvent);const o=document.createElement("button");o.id="modal-ok",o.addEventListener("click",modalOkClick),t.appendChild(o);const l=document.createElement("button");l.id="modal-cancel",l.addEventListener("click",modalCancelClick),t.appendChild(l)}function registerServiceWorker(){navigator.serviceWorker&&(navigator.serviceWorker.addEventListener("controllerchange",()=>window.location.reload()),navigator.serviceWorker.register("sw.min.js"))}function defaultSettings(){Settings.Highlight1="#CCCC00",Settings.Highlight2="#AA00CC",Settings.Highlight3="#00CCBB",Settings.Menu="Open",Settings.Theme="Light",Settings.Zoom="Fit"}function loadSettings(){defaultSettings();const e=localStorage.getItem(StoreName.Settings);if(e){const t=JSON.parse(e);t&&(t.Filters&&(t.Filters.Brightness&&(Settings.Filters.Brightness=t.Filters.Brightness),t.Filters.Contrast&&(Settings.Filters.Contrast=t.Filters.Contrast),t.Filters.Hue&&(Settings.Filters.Hue=t.Filters.Hue),t.Filters.Saturation&&(Settings.Filters.Saturation=t.Filters.Saturation)),t.Highlight1&&(Settings.Highlight1=t.Highlight1),t.Highlight2&&(Settings.Highlight2=t.Highlight2),t.Highlight3&&(Settings.Highlight3=t.Highlight3),t.Menu&&(Settings.Menu=t.Menu),t.Theme&&(Settings.Theme=t.Theme),t.Zoom&&(Settings.Zoom=t.Zoom))}}function saveSettings(){const e=JSON.stringify(Settings);localStorage.setItem(StoreName.Settings,e)}function setTheme(e){const t=document.getElementsByTagName("html")[0];switch(e){case"Light":t.className="theme-light";break;case"Dark":t.className="theme-dark";break;case"System":default:t.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-light"}}function themeChange(e){if("System"===Settings.Theme){const t=document.getElementsByTagName("html")[0];t.className=e.matches?"theme-dark":"theme-light"}}function addThemeListener(e){const t=window.matchMedia("(prefers-color-scheme: dark)");"addEventListener"in t&&t.addEventListener("change",e)}function downloadBlob(e,t){const n=document.createElement("a");n.rel="noopener",n.download=e,n.href=URL.createObjectURL(t),setTimeout(()=>URL.revokeObjectURL(n.href),45e3),setTimeout(()=>n.click(),0)}function exportPng(e,t,n){const i=document.createElement("canvas"),o=i.getContext("2d"),l=new Image;l.onload=function(){i.width=l.width,i.height=l.height,n&&(o.fillStyle=n,o.rect(0,0,i.width,i.height),o.fill()),"imageSmoothingQuality"in o&&(o.imageSmoothingQuality="high"),o.drawImage(l,0,0),i.toBlob(function(t){downloadBlob(e,t)})},l.src="data:image/svg+xml;base64,"+btoa(t)}function exportSvg(e,t){const n=new Blob([t],{type:"image/svg+xml"});downloadBlob(e,n)}function createElementFromHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}function getStringBetween(e,t,n,i){if(!e)return;if(-1===t)return;const o=e.indexOf(n,t);if(-1===o)return;const l=e.indexOf(i,o);return-1!==l?e.substring(o+1,l):void 0}function getFiltersCss(e,t,n,i){return`brightness(${(e/10).toPrecision(2)}) `+`contrast(${(t/10).toPrecision(2)}) `+`hue-rotate(${n}deg) `+`saturate(${(i/10).toPrecision(2)})`}function appOffline(){document.getElementById("offline").style.display="block"}function appOnline(){document.getElementById("offline").style.display="none"}function setupOfflineIndicator(){document.getElementById("offline").style.display=navigator.onLine?"none":"block",window.addEventListener("offline",appOffline),window.addEventListener("online",appOnline)}function modalAlert(e,t){modalOkCallback=t,document.getElementById("modal-text").textContent=e,document.getElementById("modal-input").style.display="none";const n=document.getElementById("modal-ok");n.textContent="OK",n.accessKey="o",n.style.display="inline-block",document.getElementById("modal-cancel").style.display="none",document.getElementById("modal").style.display="block",n.focus()}function modalConfirm(e,t,n){modalOkCallback=t,modalCancelCallback=n,document.getElementById("modal-text").textContent=e,document.getElementById("modal-input").style.display="none";const i=document.getElementById("modal-ok");i.textContent="Yes",i.accessKey="y",i.style.display="inline-block";const o=document.getElementById("modal-cancel");o.textContent="No",o.accessKey="n",o.style.display="inline-block",document.getElementById("modal").style.display="block"}function modalPrompt(e,t,n,i){modalOkCallback=n,modalCancelCallback=i,document.getElementById("modal-text").textContent=e;const o=document.getElementById("modal-input");o.value=t||"",o.style.display="inline-block";const l=document.getElementById("modal-ok");l.textContent="OK",l.accessKey="o",l.style.display="inline-block";const a=document.getElementById("modal-cancel");a.textContent="Cancel",a.accessKey="c",a.style.display="inline-block",document.getElementById("modal").style.display="block",o.focus()}function getModalInputText(){return document.getElementById("modal-input").value}function isEmbedded(){try{return window.self!==window.top}catch(e){return!0}}const StoreName={Flags:"flags",Settings:"settings"},Mouse={Button:{Left:0,Middle:1,Right:2,Back:3,Forward:4},Buttons:{Left:1,Right:2,Middle:4,Back:8,Forward:16},Which:{Left:1,Middle:2,Right:3}},Settings={Filters:{Brightness:10,Contrast:10,Hue:0,Saturation:10},Highlight1:"",Highlight2:"",Highlight3:"",Menu:"",Theme:"",Zoom:""},isIOSEdge=-1!==navigator.userAgent.indexOf("EdgiOS"),isIOS=-1!==window.navigator.userAgent.indexOf("iPad")||-1!==window.navigator.userAgent.indexOf("iPhone");let modalOkCallback=void 0,modalCancelCallback=void 0;registerServiceWorker(),loadSettings(),setTheme(Settings.Theme),addThemeListener(themeChange);