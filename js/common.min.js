"use strict";"function"!=typeof Array.prototype.contains&&(Array.prototype.contains=function(t){if(null===this)throw new TypeError;return-1!==this.indexOf(t)}),"function"!=typeof Array.prototype.remove&&(Array.prototype.remove=function(t){if(null===this)throw new TypeError;const e=this.indexOf(t);-1!==e&&this.splice(e,1)}),"function"!=typeof Array.prototype.fill&&(Array.prototype.fill=function(t){if(null===this)throw new TypeError;for(let e=0;e<this.length;e+=1)this[e]=t}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(t){if(null===this)throw new TypeError;return 0===this.indexOf(t)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){if(null===this)throw new TypeError;return-1!==this.indexOf(t,this.length-t.length)});const Common={ServiceWorkerJS:"sw.min.js",StoreName:{Flags:"flags",Settings:"settings"},Mouse:{Button:{Left:0,Middle:1,Right:2,Back:3,Forward:4},Buttons:{Left:1,Right:2,Middle:4,Back:8,Forward:16},Which:{Left:1,Middle:2,Right:3}},Settings:{Filters:{Brightness:10,Contrast:10,Hue:0,Saturation:10},Highlight1:"",Highlight2:"",Highlight3:"",Menu:"",Theme:"",Zoom:""},isIE:-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident"),isIOSChrome:-1!==navigator.userAgent.indexOf("CriOS"),isIOSEdge:-1!==navigator.userAgent.indexOf("EdgiOS"),isIOS:-1!==window.navigator.userAgent.indexOf("iPad")||-1!==window.navigator.userAgent.indexOf("iPhone"),updateRefresh:!1,controllerChanged:function(){this.updateRefresh||(this.updateRefresh=!0,window.location.reload())},registerServiceWorker:function(){"serviceWorker"in navigator&&(navigator.serviceWorker.register(this.ServiceWorkerJS,{scope:"/"}),navigator.serviceWorker.addEventListener("controllerchange",this.controllerChanged))},defaultSettings:function(){this.Settings.Highlight1="#CCCC00",this.Settings.Highlight2="#AA00CC",this.Settings.Highlight3="#00CCBB",this.Settings.Menu="Open",this.Settings.Theme="Light",this.Settings.Zoom="Fit"},loadSettings:function(){this.defaultSettings();const t=localStorage.getItem(this.StoreName.Settings);if(t){const e=JSON.parse(t);e&&(e.Filters&&(e.Filters.Contrast&&(this.Settings.Filters.Contrast=e.Filters.Contrast),e.Filters.Hue&&(this.Settings.Filters.Hue=e.Filters.Hue),e.Filters.Saturation&&(this.Settings.Filters.Saturation=e.Filters.Saturation)),e.Highlight1&&(this.Settings.Highlight1=e.Highlight1),e.Highlight2&&(this.Settings.Highlight2=e.Highlight2),e.Highlight3&&(this.Settings.Highlight3=e.Highlight3),e.Menu&&(this.Settings.Menu=e.Menu),e.Theme&&(this.Settings.Theme=e.Theme),e.Zoom&&(this.Settings.Zoom=e.Zoom))}},saveSettings:function(){const t=JSON.stringify(this.Settings);localStorage.setItem(this.StoreName.Settings,t)},setTheme:function(t){const e=document.getElementsByTagName("html")[0];switch(t){case"Light":e.className="theme-light";break;case"Dark":e.className="theme-dark";break;case"System":default:e.className=window.matchMedia("(prefers-color-scheme: dark)").matches?"theme-dark":"theme-light"}},themeChange:function(t){if("System"===Common.Settings.Theme){const e=document.getElementsByTagName("html")[0];e.className=t.matches?"theme-dark":"theme-light"}},addThemeListener:function(t){const e=window.matchMedia("(prefers-color-scheme: dark)");"addEventListener"in e&&e.addEventListener("change",t)},exportPng:function(t,e,i){const n=document.createElement("canvas"),o=n.getContext("2d"),r=new Image;r.onload=function(){n.width=r.width,n.height=r.height,i&&(o.fillStyle=i,o.rect(0,0,n.width,n.height),o.fill()),"imageSmoothingQuality"in o&&(o.imageSmoothingQuality="high"),o.drawImage(r,0,0),n.toBlob(function(e){Common.downloadBlob(t,e)})},r.src="data:image/svg+xml;base64,"+btoa(e)},exportSvg:function(t,e){const i=new Blob([e],{type:"image/svg+xml"});Common.downloadBlob(t,i)},simulateClick:function(t){t.click()},downloadBlob:function(t,e){if("msSaveBlob"in navigator)navigator.msSaveBlob(e,t);else{const i=document.createElement("a");i.rel="noopener",i.download=t,i.href=URL.createObjectURL(e),setTimeout(function(){URL.revokeObjectURL(i.href)},45e3),setTimeout(function(){Common.simulateClick(i)},0)}},createElementFromHtml:function(t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild},getStringBetween:function(t,e,i,n){if(!t)return;if(-1===e)return;const o=t.indexOf(i,e);if(-1===o)return;const r=t.indexOf(n,o);return-1!==r?t.substring(o+1,r):void 0},getFiltersCss:function(t,e,i,n){return"brightness("+(t/10).toPrecision(2)+") contrast("+(e/10).toPrecision(2)+") hue-rotate("+i+"deg) saturate("+(n/10).toPrecision(2)+")"},fixToMaxItemWidth:function(t,e,i){let n=0;const o=document.getElementsByClassName(t);for(let t=0;t<o.length;t+=1){const e=o[t];i&&""!==e.style.width&&(e.style.width=""),e.clientWidth>n&&(n=e.clientWidth)}n+=e;for(let t=0;t<o.length;t+=1){const e=o[t];e.style.width=n+"px"}},headerEnter:function(t){let e=t.target.getElementsByTagName("a");0!==e.length&&(e=e.item(0),e.style.display="inline")},headerLeave:function(t){let e=t.target.getElementsByTagName("a");0!==e.length&&(e=e.item(0),e.style.display="none")},setupHeaders:function(t){const e=document.getElementsByTagName(t);for(let t=0;t<e.length;t+=1){const i=e[t];i.addEventListener("mouseenter",this.headerEnter),i.addEventListener("mouseleave",this.headerLeave);let n=i.getElementsByTagName("a");0!==n.length&&(n=n.item(0),n.href="#"+i.id)}},customAlert:function(t){window.alert(t)},customConfirm:function(t){return window.confirm(t)},customPrompt:function(t,e){return window.prompt(t,e)}};Common.registerServiceWorker(),Common.loadSettings(),Common.setTheme(Common.Settings.Theme),Common.addThemeListener(Common.themeChange);