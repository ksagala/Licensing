function filterChange(){SvgModule.Data.Tag.style.filter=Common.getFiltersCss(PageData.Controls.Brightness.value,PageData.Controls.Contrast.value,PageData.Controls.Hue.value,PageData.Controls.Saturation.value)}function filterResetClick(){PageData.Controls.Brightness.value=PageData.Controls.Brightness.defaultValue,PageData.Controls.Contrast.value=PageData.Controls.Contrast.defaultValue,PageData.Controls.Hue.value=PageData.Controls.Hue.defaultValue,PageData.Controls.Saturation.value=PageData.Controls.Saturation.defaultValue,filterChange()}function filterSaveClick(){Common.Settings.Filters.Brightness=PageData.Controls.Brightness.value,Common.Settings.Filters.Contrast=PageData.Controls.Contrast.value,Common.Settings.Filters.Hue=PageData.Controls.Hue.value,Common.Settings.Filters.Saturation=PageData.Controls.Saturation.value,Common.saveSettings(),PageData.ControlsOpen=!1,setControlsPosition()}function setControlsPosition(){if(Common.isIE)return;const e=document.getElementById("imageControls");e.style.top=PageData.ControlsOpen?"24px":"-300px",e.style.display="block"}function setupImageControls(){Common.isIE||(PageData.Controls.Brightness=document.getElementById("brightness"),PageData.Controls.Contrast=document.getElementById("contrast"),PageData.Controls.Hue=document.getElementById("hue"),PageData.Controls.Saturation=document.getElementById("saturation"),PageData.Controls.Brightness.value=Common.Settings.Filters.Brightness,PageData.Controls.Contrast.value=Common.Settings.Filters.Contrast,PageData.Controls.Hue.value=Common.Settings.Filters.Hue,PageData.Controls.Saturation.value=Common.Settings.Filters.Saturation,PageData.Controls.Brightness.addEventListener("input",filterChange),PageData.Controls.Contrast.addEventListener("input",filterChange),PageData.Controls.Hue.addEventListener("input",filterChange),PageData.Controls.Saturation.addEventListener("input",filterChange),document.getElementById("reset").addEventListener("click",filterResetClick),document.getElementById("save").addEventListener("click",filterSaveClick))}function updateMenu(){const e=document.getElementById("menu"),t=document.getElementById("menuGrip"),n=document.getElementById("menuFlag"),a=document.getElementById("menuPdf"),o=document.getElementById("menuPng"),l=document.getElementById("menuSave"),i=document.getElementById("menuHighlight"),s=document.getElementById("menuExportSvg"),g=document.getElementById("menuExportPng");if(Common.isIOSEdge){const e=document.getElementById("menuPrint");e.style.display="none"}SvgModule.Data.Highlighting?(i.src="/media/edit-on.svg",i.title="Turn off highlighter"):(i.src="/media/edit-off.svg",i.title="Turn on highlighter"),PageData.Flagged?(n.src="/media/flagged.svg",n.title="Remove flag"):(n.src="/media/unflagged.svg",n.title="Flag this diagram"),SvgModule.Data.Highlighting?(l.style.display="inline",s.style.display=Common.isIOSEdge?"none":"inline",g.style.display=Common.isIOSEdge||Common.isIE?"none":"inline"):(l.style.display="none",s.style.display="none",g.style.display="none"),n.style.display="inline",SvgModule.Data.Highlighting?(a.style.display="none",o.style.display="none"):(a.style.display="inline",o.style.display="inline"),e.style.display="block",PageData.MenuOffset=e.clientWidth-t.clientWidth-4}function appOffline(){document.getElementById("offline").style.display="block",updateMenu()}function appOnline(){document.getElementById("offline").style.display="none",updateMenu()}function setMenuPosition(){const e=document.getElementById("menu"),t=document.getElementById("menuGrip");PageData.MenuOpen?(t.title="Close menu",t.src="/media/close.svg",e.style.right=0):(t.title="Open menu",t.src="/media/open.svg",e.style.right=-PageData.MenuOffset+"px")}function menuGripClick(){PageData.MenuOpen=!PageData.MenuOpen,setMenuPosition()}function flagClick(e){if(e.preventDefault(),PageData.Flagged){const e=PageData.Flags.indexOf(PageData.Filename);e>-1&&PageData.Flags.splice(e,1),PageData.Flagged=!1}else PageData.Flags.push(PageData.Filename),PageData.Flagged=!0;localStorage.setItem(Common.StoreName.Flags,JSON.stringify(PageData.Flags)),updateMenu()}function printClick(e){e.preventDefault(),window.print()}function menuHighlightClick(e){e.preventDefault(),SvgModule.Data.Highlighting=!SvgModule.Data.Highlighting,updateMenu()}function menuControlsClick(e){e.preventDefault(),PageData.ControlsOpen=!PageData.ControlsOpen,setControlsPosition()}function menuSaveClick(e){e.preventDefault();let t=decodeURIComponent(PageData.Filename);if(t=Common.customPrompt("Save diagram as:",t),!t)return;let n=Date.now().toString();const a=SvgModule.getSvgXml(),o={Title:t,SvgXml:a},l=JSON.stringify(o);localStorage.setItem(n,l)}function exportSvgClick(e){e.preventDefault();const t=decodeURIComponent(PageData.Filename)+".svg",n=SvgModule.getSvgXml();Common.exportSvg(t,n)}function exportPngClick(e){if(e.preventDefault(),Common.isIE)return;const t=window.getComputedStyle(document.body).backgroundColor,n=decodeURIComponent(PageData.Filename)+".png",a=SvgModule.getSvgXml();Common.exportPng(n,a,t)}function setupMenu(){document.getElementById("menuGrip").addEventListener("click",menuGripClick),document.getElementById("menuFlag").addEventListener("click",flagClick),document.getElementById("menuPrint").addEventListener("click",printClick),document.getElementById("menuHighlight").addEventListener("click",menuHighlightClick);const e=document.getElementById("menuControls");Common.isIE?e.style.display="none":e.addEventListener("click",menuControlsClick),document.getElementById("menuSave").addEventListener("click",menuSaveClick),document.getElementById("menuExportSvg").addEventListener("click",exportSvgClick),document.getElementById("menuExportPng").addEventListener("click",exportPngClick),PageData.MenuOpen="Open"===Common.Settings.Menu}function loadFlags(){const e=localStorage.getItem(Common.StoreName.Flags);if(e){const t=JSON.parse(e);t&&(PageData.Flags=t)}}function pageLoad(){const e="#blank"===window.location.hash;e||(setupMenu(),setupImageControls(),loadFlags(),PageData.Filename=window.location.pathname.substring(1,window.location.pathname.length-4),PageData.Flagged=PageData.Flags.contains(PageData.Filename)),SvgModule.Data.Tag=document.getElementsByTagName("svg").item(0),SvgModule.injectHighlightStyles(),SvgModule.sizeSvg(),SvgModule.registerEvents(),Common.isIE||filterChange(),e||(updateMenu(),setMenuPosition(),setControlsPosition(),document.getElementById("offline").style.display=navigator.onLine?"none":"block",window.addEventListener("offline",appOffline),window.addEventListener("online",appOnline))}const PageData={Controls:{Brightness:null,Contrast:null,Hue:null,Saturation:null},ControlsOpen:!1,Filename:"",MenuOffset:0,MenuOpen:!1,Flagged:!1,Flags:[]};window.addEventListener("load",pageLoad);