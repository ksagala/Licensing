function newDivider(){const e=document.createElement("div");return e.className="divider",e}function newActions(){const e=document.createElement("div");return e.className="actions",e}function newDiagramLink(e,t){const n=document.createElement("a");return n.className="diagram",n.textContent=e,n.href=t,n}function newPngButton(){const e=document.createElement("button");return e.className="export",e.title="Export PNG",e.textContent="PNG",e}function newSvgButton(){const e=document.createElement("button");return e.className="export",e.title="Export SVG",e.textContent="SVG",e}function newDeleteButton(){const e=document.createElement("button");return e.className="delete",e.title="Delete",e}function newRenameButton(){const e=document.createElement("button");return e.className="rename",e.title="Rename",e}function addEmptyMessage(e){const t=document.createElement("p");t.innerText="There are no saved diagrams.",e.appendChild(t)}function addNewRow(e,t,n){const o=newDiagramLink(n.Title,"/viewsvg.htm#*"+t);e.appendChild(o);const l=newActions(),a=newDivider(),d=newRenameButton();l.appendChild(d),d.addEventListener("click",function(){modalPrompt("Rename saved diagram:",o.textContent,function(){const e=getModalInputText();if(!e)return;n.Title=e;const l=JSON.stringify(n);localStorage.setItem(t,l),o.textContent=e})});const i=newDeleteButton();if(l.appendChild(i),i.addEventListener("click",function(){const n=`Are you sure you want to delete "${o.textContent}"?`;modalConfirm(n,function(){localStorage.removeItem(t),e.removeChild(o),e.removeChild(l),e.removeChild(a),0===e.getElementsByClassName("diagram").length&&(e.innerHTML="",e.appendChild(newDivider()),addEmptyMessage(e),e.appendChild(newDivider()))})}),!isIOSEdge){const e=newSvgButton();l.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),exportSvg(n.Title+".svg",n.SvgXml)});const t=newPngButton();l.appendChild(t),t.addEventListener("click",function(){const e=window.getComputedStyle(document.body).backgroundColor;exportPng(n.Title+".png",n.SvgXml,e)})}e.appendChild(l),e.appendChild(a)}function populateList(){const e=document.getElementById("collection");e.innerHTML="",e.appendChild(newDivider());let t=[];for(let e=0;e<localStorage.length;e+=1){const n=localStorage.key(e);n!==StoreName.Flags&&n!==StoreName.Settings&&t.push(n)}t=t.sort(function(e,t){return parseInt(e)-parseInt(t)});for(let n=0;n<t.length;n+=1){const o=t[n],l=localStorage.getItem(o);if(l){const t=JSON.parse(l);t&&addNewRow(e,o,t)}}0===t.length&&(addEmptyMessage(e),e.appendChild(newDivider()))}function filesSelected(e){const t=new FileReader,n=e.target.files;for(let e=0;e<n.length;e++){const o=n[e];t.addEventListener("load",function(e){modalPrompt("Import diagram as:",o.name,function(){const t=getModalInputText();if(!t)return;const n=Date.now().toString(),o={Title:t,SvgXml:e.target.result},l=JSON.stringify(o);localStorage.setItem(n,l);const a=document.getElementById("collection");addNewRow(a,n,o)})}),t.readAsText(o)}e.target.value=""}function exportAllDiagrams(e){const t=document.getElementsByClassName("export");for(let n=0;n<t.length;n++){const o=t[n];o.textContent===e&&o.click()}}function DOMContentLoaded(){isEmbedded()&&(document.getElementById("menu").style.display="none"),setupOfflineIndicator(),setupModal(),populateList(),isIOS?document.getElementById("export-all-png").style.display="none":document.getElementById("export-all-png").addEventListener("click",()=>exportAllDiagrams("PNG")),isIOS?document.getElementById("export-all-svg").style.display="none":document.getElementById("export-all-svg").addEventListener("click",()=>exportAllDiagrams("SVG")),document.getElementById("import").addEventListener("click",()=>document.getElementById("file-selector").click()),document.getElementById("file-selector").addEventListener("change",filesSelected)}document.addEventListener("DOMContentLoaded",DOMContentLoaded);