function newDivider(){const e=document.createElement("div");return e.className="divider",e}function newActions(){const e=document.createElement("div");return e.className="actions",e}function newHeader(){const e=document.createElement("h2");return e}function newDiagramLink(e,t){const n=document.createElement("a");return n.className="diagram",n.text=e,n.href=t,n}function newPngLink(){const e=document.createElement("a");return e.href="#",e.className="export",e.title="Export PNG",e.text="PNG",e}function newSvgLink(){const e=document.createElement("a");return e.href="#",e.className="export",e.title="Export SVG",e.text="SVG",e}function newDeleteImage(){const e=document.createElement("img");return e.src="/media/delete.svg",e.width=16,e.height=16,e.alt="Delete",e.title="Delete",e.className="delete",e}function newRenameImage(){const e=document.createElement("img");return e.src="/media/edit-off.svg",e.width=16,e.height=16,e.alt="Rename",e.title="Rename",e.className="rename",e}function addEmptyMessage(e){const t=document.createElement("h2");t.innerText="There are no saved diagrams.",e.appendChild(t)}function addNewRow(e,t,n){const o=newHeader(),i=newDiagramLink(n.Title,"/viewsvg.htm#*"+t);o.appendChild(i),e.appendChild(o);const a=newActions(),l=newRenameImage();a.appendChild(l);const m=newDivider();l.addEventListener("click",function(){const e=Common.customPrompt("Rename saved diagram:",i.textContent);if(e){n.Title=e;const o=JSON.stringify(n);localStorage.setItem(t,o),i.textContent=e,Common.isIE&&Common.fixToMaxItemWidth("diagram",20,!0)}});const d=newDeleteImage();if(a.appendChild(d),d.addEventListener("click",function(){const n='Are you sure you want to delete "'+i.textContent+'"?';Common.customConfirm(n)&&(localStorage.removeItem(t),e.removeChild(o),e.removeChild(a),e.removeChild(m),0===e.getElementsByTagName("h2").length&&(e.innerHTML="",e.appendChild(newDivider()),addEmptyMessage(e),e.appendChild(newDivider())))}),!Common.isIOSEdge){const e=newSvgLink();a.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),Common.exportSvg(n.Title+".svg",n.SvgXml)})}if(!Common.isIOSEdge&&!Common.isIE){const e=newPngLink();a.appendChild(e),e.addEventListener("click",function(e){e.preventDefault();const t=window.getComputedStyle(document.body).backgroundColor;Common.exportPng(n.Title+".png",n.SvgXml,t)})}e.appendChild(a),e.appendChild(m)}function populateList(){const e=document.getElementById("collection");e.innerHTML="",e.appendChild(newDivider());let t=[];for(let e=0;e<localStorage.length;e+=1){const n=localStorage.key(e);n!==Common.StoreName.Flags&&n!==Common.StoreName.Settings&&t.push(n)}t=t.sort(function(e,t){return parseInt(e)-parseInt(t)});for(let n=0;n<t.length;n+=1){const o=t[n],i=localStorage.getItem(o);if(i){const t=JSON.parse(i);t&&addNewRow(e,o,t)}}0===t.length?(addEmptyMessage(e),e.appendChild(newDivider())):Common.isIE&&Common.fixToMaxItemWidth("diagram",20,!1)}function filesSelected(e){const t=new FileReader,n=e.target.files;for(let e=0;e<n.length;e++){const o=n[e];t.addEventListener("load",function(e){let t=o.name;if(t=Common.customPrompt("Import diagram as:",t),t){const n=Date.now().toString(),o={Title:t,SvgXml:e.target.result},i=JSON.stringify(o);localStorage.setItem(n,i);const a=document.getElementById("collection");addNewRow(a,n,o)}}),t.readAsText(o)}const o=document.getElementById("fileSelector");o.value=""}function exportAllDiagrams(e){const t=document.getElementsByClassName("export");for(let n=0;n<t.length;n++){const o=t[n];o.textContent===e&&Common.simulateClick(o)}}function exportAllDiagramsSvg(){exportAllDiagrams("SVG")}function exportAllDiagramsPng(){exportAllDiagrams("PNG")}function importDiagram(){const e=document.getElementById("fileSelector");Common.simulateClick(e)}function appOffline(){document.getElementById("offline").style.display="block"}function appOnline(){document.getElementById("offline").style.display="none"}function pageLoad(){populateList();const e=document.getElementById("exportAllPng");Common.isIE||Common.isIOS?e.style.display="none":e.addEventListener("click",exportAllDiagramsPng);const t=document.getElementById("exportAllSvg");Common.isIOS?t.style.display="none":t.addEventListener("click",exportAllDiagramsSvg),document.getElementById("import").addEventListener("click",importDiagram),document.getElementById("fileSelector").addEventListener("change",filesSelected),document.getElementById("offline").style.display=navigator.onLine?"none":"block",window.addEventListener("offline",appOffline),window.addEventListener("online",appOnline)}window.addEventListener("load",pageLoad);